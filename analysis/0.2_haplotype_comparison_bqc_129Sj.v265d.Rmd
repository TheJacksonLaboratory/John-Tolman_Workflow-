---
title: "Haplotype Phasing Before QC [129Sj.v265d]"
author: "Belinda Cornes"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

filepathp = '/Users/corneb/Documents/MyJax/CS/Projects/Simon.John.Tolman/Data/meta.data/'
filepaths = '/Users/corneb/Documents/MyJax/CS/Projects/Simon.John.Tolman/haplo.reconst/2020-11-11/129Sj.v265d/all_samples_sorted/'
#setwd(filepaths)

#libraries
library(broman)
library(qtl2)

```

### Loading Project
```{r load project, eval=TRUE}

gm <- read_cross2("/Users/corneb/Documents/MyJax/CS/Projects/Simon.John.Tolman/haplo.reconst/2020-11-11/129Sj.v265d/all_samples_sorted/qtl2/gm_sorted.json")

#gm <- get(load("gm_DO.RData"))
gm

pr <- readRDS("/Users/corneb/Documents/MyJax/CS/Projects/Simon.John.Tolman/haplo.reconst/2020-11-11/129Sj.v265d/all_samples_sorted/Jax.Columbia_John__GigaMUGA_genoprobs_8state_sorted.rds")
mice <- ind_ids(gm)
micelg <- as.data.frame(mice)
micelg$miceids <- sapply(strsplit(as.character(micelg$mice),'_',fixed=T),function(x) x[6])
micelg <- micelg[order(micelg$miceids),]
mice <- micelg$mice

````

### Phased Plots
```{r phased plots, eval=TRUE}

for(i in mice){

	print(i)
	mouse.id <- sapply(strsplit(as.character(i),'_',fixed=T),function(x) x[6])
	print(mouse.id)

	gmi <- gm[i, ] 
	#map <- insert_pseudomarkers(gmi$gmap, step=1)
	#pr <- calc_genoprob(gmi, map, error_prob=0.002)
	pr.new <- pr[i,]

	# infer genotypes, as those with maximal marginal probability
	m <- maxmarg(pr.new, minprob = 0.2)

	# guess phase
	ph <- guess_phase(gmi, m)

	# plot phased genotypes
	plot_onegeno(ph, gmi$gmap, main = paste0(i," [genoprobs]"),  shift=TRUE)
}
```